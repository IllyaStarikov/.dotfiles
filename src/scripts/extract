#!/usr/bin/env zsh
# extract - Universal Archive Extractor
#
# DESCRIPTION:
#   Automatically detects and extracts various archive formats.
#   Eliminates need to remember different extraction commands.
#
# USAGE:
#   extract <archive>
#
# SUPPORTED FORMATS:
#   tar.bz2, tar.gz, tar.xz, bz2, rar, gz, tar, tbz2, tgz, zip, Z, 7z, xz
#
# Style Guide: https://google.github.io/styleguide/shellguide.html

# Validate arguments
if [[ -z "$1" ]]; then
    echo "Usage: extract <archive>"
    echo "Supported formats: tar.bz2, tar.gz, tar.xz, bz2, rar, gz, tar, tbz2, tgz, zip, Z, 7z, xz"
    exit 1
fi

# Check if file exists and is readable
if [[ ! -f "$1" ]]; then
    echo "Error: '$1' is not a valid file"
    exit 1
fi

# Extract based on file extension
# Uses most common extraction flags for each format
case "$1" in
    *.tar.bz2) tar xjf "$1" ;;      # Bzip2 compressed tar
    *.tar.gz)  tar xzf "$1" ;;      # Gzip compressed tar
    *.tar.xz)  tar xJf "$1" ;;      # XZ compressed tar
    *.bz2)     bunzip2 "$1" ;;      # Bzip2 single file
    *.rar)
        if command -v unrar &>/dev/null; then
            unrar x "$1"
        else
            echo "Error: unrar not installed"
            echo "Install with:"
            echo "  macOS:  brew install unrar"
            echo "  Linux:  apt install unrar"
            exit 1
        fi ;;
    *.gz)      gunzip "$1" ;;       # Gzip single file
    *.tar)     tar xf "$1" ;;       # Uncompressed tar
    *.tbz2)    tar xjf "$1" ;;      # Alternative bzip2 tar extension
    *.tgz)     tar xzf "$1" ;;      # Alternative gzip tar extension
    *.zip)     unzip "$1" ;;        # ZIP archive
    *.Z)       uncompress "$1" ;;   # Unix compress format
    *.7z)
        if command -v 7z &>/dev/null; then
            7z x "$1"
        else
            echo "Error: 7z not installed"
            echo "Install with:"
            echo "  macOS:  brew install p7zip"
            echo "  Linux:  apt install p7zip-full"
            exit 1
        fi ;;
    *.xz)      xz -d "$1" ;;        # XZ single file
    *)
        echo "Error: '$1' cannot be extracted via extract"
        echo "Unknown archive format"
        exit 1
        ;;
esac

# Report success
echo "âœ“ Extracted: $1"