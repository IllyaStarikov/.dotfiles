#!/usr/bin/env zsh
# Cortex AI Model Management System
# ==================================
# Local AI assistant for coding with MLX acceleration on Apple Silicon
# Manages AI models, provides chat interface, and agent mode for automation
#
# USAGE:
#   cortex              # Interactive chat with AI
#   cortex status       # Check MLX server status
#   cortex model <name> # Switch AI model
#   cortex agent on     # Enable agent mode
#
# MODELS:
#   Default uses Mistral or similar lightweight model
#   Larger models available with more memory
#
# REQUIREMENTS:
#   Python 3.8+, MLX library (Apple Silicon)
#   Models downloaded automatically on first use
#
# Reference: https://github.com/ml-explore/mlx

# Add the cortex module to Python path
export PYTHONPATH="$HOME/.dotfiles/src/cortex:$PYTHONPATH"

# Initialize pyenv if available (needed for non-interactive shells)
if [[ -d "$HOME/.pyenv" ]]; then
  export PYENV_ROOT="$HOME/.pyenv"
  export PATH="$PYENV_ROOT/bin:$PYENV_ROOT/shims:$PATH"
fi

# Find Python (prefer python3 over python)
if command -v python3 &>/dev/null; then
  PYTHON_CMD="python3"
elif command -v python &>/dev/null; then
  PYTHON_CMD="python"
else
  echo "Error: Python not found. Please install Python 3." >&2
  exit 1
fi

# Run cortex with all arguments
exec "$PYTHON_CMD" -m cortex.cli "$@"