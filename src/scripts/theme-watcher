#!/usr/bin/env python3
"""
Theme watcher - monitors macOS appearance changes and auto-switches themes
Uses FSEvents to watch for preference changes efficiently
"""

import subprocess
import time
import os
from pathlib import Path

def get_appearance():
    """Get current macOS appearance (light/dark)"""
    try:
        result = subprocess.run(
            ['defaults', 'read', '-g', 'AppleInterfaceStyle'],
            capture_output=True,
            text=True
        )
        return 'dark' if result.returncode == 0 and result.stdout.strip() == 'Dark' else 'light'
    except:
        return 'light'

def switch_theme():
    """Run the theme switcher script"""
    script_path = Path(__file__).parent.parent / 'theme-switcher' / 'switch-theme.sh'
    if script_path.exists():
        subprocess.run([str(script_path), 'auto'], capture_output=True)

def main():
    """Main monitoring loop"""
    last_appearance = get_appearance()
    
    while True:
        current_appearance = get_appearance()
        
        if current_appearance != last_appearance:
            switch_theme()
            last_appearance = current_appearance
        
        # Check every 2 seconds for responsiveness
        time.sleep(2)

if __name__ == '__main__':
    main()