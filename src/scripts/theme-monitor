#!/bin/bash
# Theme monitor - watches for macOS appearance changes and auto-switches themes

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
THEME_SWITCHER="$SCRIPT_DIR/../theme-switcher/switch-theme.sh"

# Function to get current macOS appearance
get_appearance() {
    if [[ "$(defaults read -g AppleInterfaceStyle 2>/dev/null)" == "Dark" ]]; then
        echo "dark"
    else
        echo "light"
    fi
}

# Store the current appearance
LAST_APPEARANCE=$(get_appearance)

# Monitor for changes
while true; do
    CURRENT_APPEARANCE=$(get_appearance)
    
    if [[ "$CURRENT_APPEARANCE" != "$LAST_APPEARANCE" ]]; then
        # Appearance changed, switch theme
        "$THEME_SWITCHER" auto >/dev/null 2>&1
        LAST_APPEARANCE=$CURRENT_APPEARANCE
    fi
    
    # Check every 5 seconds
    sleep 5
done